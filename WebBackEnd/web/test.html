<!DOCTYPE html>
<html>
<head>
    <title>Test</title>
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css'/>

    <script src="js/jquery.min.js"></script>
    <script src="js/helpFunction.js"></script>

    <link href="css/hover.css" rel="stylesheet" media="all">
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>


    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link href='http://fonts.useso.com/css?family=Lato:100,300,400,700,900' rel='stylesheet' type='text/css'>

</head>

<body>
<div class="testUser">
    <button onclick="testLogin();"> testLogin</button>

    <button onclick="testReg();"> testReg</button>
</div>

<div class="testLogic">
    <button onclick="testSellOrder();"> testSellOrder</button>
    <button onclick="testBuyOrder()"> testBuyOrder</button>
    <button onclick="testCancelOrder()"> testCancelOrder</button>
    <button onclick="testDoTrade();"> testDoTrade</button>
</div>

<div>
    <button onclick="testQueryProductList();"> testQueryProductList</button>
    <button onclick="testQueryUserList()"> testQueryUserList</button>
    <button onclick="testQueryOrderList()"> testQueryOrderList</button>
</div>

</body>

<script>
    //------------------------------------ 用户操作 -----------------------------
    function testLogin()
    {
        ajax("User", "get", {
            action: "login",
            username: "admin",
            password: "admin"
        })
    }

    function testReg()
    {
        //登陆时候的两个密码是否相同的检查在前端做，传给后端的话直接一个json对象就好
        ajax("User","get", {
            action : "register",
            userData : JSON.stringify({
                username : "tempuser",
                company : "M",          //用户公司名，显示用的
                password : "temppwd",
                role : "BROKER"       //用户职能，只能注册为BROKER或者是TRADER，默认是BROKER
            })
        });
    }

    //-------------------------------------业务逻辑------------------------------

    //TODO 之后要向老师问一下这个LIMIT和STOP实时性的问题，市场订单和购买订单直接进入执行状态,对于卖操作如果条件成立就一直卖，中途不符合价格了会不会继续回到doing。buy订单应该永远是doing。
    //订单一共四种状态（TODO：需要执行，DOING：正在执行，DONE：已经完成）
    function testSellOrder()
    {
        ajax("Logic","post", {
            action : "createOrder",
            orderData : JSON.stringify({
                productId: 1,    //productid已经包含了brokerId的信息
                userId: 4,          //订单发起人id
                isSell:1,      //买还是卖，不要用true和false，1表示卖，0表示买
               // status: "TODO",   //需要执行,订单一共四种状态（TODO：需要执行，DOING：正在执行，DONE：已经完成）
                type: "MARKET",   //订单类型，三种：MARKET，LIMIT(优于当前市场价时购买/交易)，STOP(优于用户指定价时购买/交易)
               // condition: "1124,2500", // 针对LIMIT和STOP订单的触发条件, 如果是LIMIT的话要在前端自动填充这个condition,
                //表示订单的触发条件，逗号分隔的两个舒，表示一旦市价落到这个范围里(1124<=marketPrice<=2500)就触发订单，如果是“1124,”就是表示单向,在market订单里无效，取消注释传上了也无视，
                expectedVol: 100, //预期交易量
                price: 100.5 ,  //交易单价

            })
        })
    }


    function testBuyOrder()
    {
        ajax("Logic","post", {
            action : "createOrder",
            orderData : JSON.stringify({
                productId: 1,
                userId: 4,      //订单发起人id
                isSell:0,      //买还是卖，不要用true和false，1表示卖，0表示买

                type: "LIMIT",   //订单类型，三种：MARKET，LIMIT(优于当前市场价时购买/交易)，STOP(优于用户指定价时购买/交易)
                condition: "110,500", // 针对LIMIT和STOP订单的触发条件, 如果是LIMIT的话要在前端自动填充这个condition,
                //表示订单的触发条件，逗号分隔的两个舒，表示一旦市价落到这个范围里(1124<=marketPrice<=2500)就触发订单，如果是“1124,”就是表示单向,在market订单里无效，取消注释传上了也无视，
                expectedVol: 150, //预期交易量
            })
        })
    }

    function testCancelOrder()
    {
        ajax("Logic","post",{
            action : "cancelOrder",
            orderId: 10,
        })
    }

    function testDoTrade()
    {
        ajax("Logic","post", {
            action : "doTrade"
        })
    }

    //---------------------------------------------查询操作-------------------------
    // 查询操作为了方便筛选，提供一个filter参数，key就是属性名，值是要求。比如 kind:"Energy"就是找出所有类型是kind的productlist。
    // 对于product，会多一个市场价的属性。

    function testQueryProductList()
    {
        ajax("Query","get",{
            action: "productList",
            filter: JSON.stringify({    //查询操作的filter都是一个筛选器，一般属性必须和filter里的参数一模一样的才能获得
                kind : "Energy",
                //id: 2               //查询之后，对于整数型参数，也可以为字符串型，比如写成id:"2"，我写了处理，后台能够自动把字符串转成整数。

            })
        })
    }


    // 查询方法是无法获得密码的
    function testQueryUserList()
    {
        ajax("Query","get",{
            action: "userList",
            filter: JSON.stringify({
                id: 2
            })
        })
    }


    function testQueryOrderList()
    {
        ajax("Query","get",{
            action: "orderList",
            filter: JSON.stringify({
                "sort": ["price","asc"],    //价格按照按asc价格升序返回，desc按降序返回
                "maxNum": 4,               //最多返回几条数据，如果要做翻页，每页显示有限个，可以集合startNum去使用
                "startNum":1               //返回从第startNum条开始的数据，为1的话就是跳过第一个
            })
        })
    }


    //broker也是选择的

</script>